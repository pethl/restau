<div class="row">
<div class="col-md-2">
<%= render 'layouts/sidebar' %>
</div>

<div class="col-md-8">
<h6><small><b><%= @dailybank.effective_date.strftime('%A, %d %b %Y') %></b></small></h6> 


<h3><%= @dailybank.status %></h3> 

<%= form_for(@dailybank) do |f| %>
  <% if @dailybank.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@dailybank.errors.count, "error") %> prohibited this dailybank from being saved:</h2>

      <ul>
      <% @dailybank.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>
  
   <% unless current_user.admin?  || current_user.super_user? %>
     <br>
     <p>Thank you for completing this End of Night record.</p>
     
     <% else %> 
   
  <h6><small>1. If any changes made or comments added click RE-CALCULATE.<br>
  2. Click MGMT LOCK to lock record.</small></h6>
<br>
<div class="row">
  <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :till_float %></font>
  <% float = @dailybank.cashfloats.where(:period => "Morning") %>
 <% if float.any? %>
    <% if float[0].float_actual == float[0].float_target %><font color=#00ff00> <i class='glyphicon glyphicon-ok aria-hidden="true"'></font></i>
      <% else %> <font color=#ff0000> <i class='glyphicon glyphicon-remove'></i>(<%= float[0].float_actual %>)<% end %><% end %>
  
  <br>
  <font color=#D3D3D3><%= f.label :till_cash %></font><br>
  </div>
  <div class="col-md-2">
  <%= f.text_field :till_float, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.till_float, :precision => 2)) %> <br>
  <%= f.text_field :till_cash, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.till_cash, :precision => 2)) %> <br>
  </div>
  <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :banking, "Banking Total" %></font><br>
  <%= link_to "See AM Float", show_float_cashfloats_path(:id => @dailybank.cashfloats.first.id), :class => "btn btn-xs btn-success", :style => "color:black" %><br> 
  <%= link_to "See PM Banking", show_float_cashfloats_path(:id => @dailybank.cashfloats.second.id), :class => "btn btn-xs btn-success", :style => "color:black" %> 
 
  </div>       
  <div class="col-md-2">
  <%= f.text_field :banking, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.banking, :precision => 2)) %> <br>
  
  </div>  
  <div class="col-md-2"> 
   <%= f.text_field :total_expected_cash, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.total_expected_cash, :precision => 2)) %><br>
   <font color=#D3D3D3>Till Report Cash</font> 
  </div>  
  <div class="col-md-2"style="text-align:right"> 
   <font color=#ffffff><b><%= sprintf "%.2f", (@dailybank.banking- @dailybank.total_expected_cash) %></font></b><br>
   <font color=#D3D3D3>Bank/Cash Var</font> 
  </div>      
</div>

<div class="row">
  <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :card_1 %></font><br>
  <font color=#D3D3D3><%= f.label :card_2 %></font><br>
  </div>
  <div class="col-md-2">
  <%= f.text_field :card_1, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.card_1, :precision => 2)) %> <br>
  <%= f.text_field :card_2, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.card_2, :precision => 2)) %> <br>
  </div>
  <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :banking, "Cards Total" %></font><br>
  </div>       
  <div class="col-md-2">
  <%= f.text_field :card_payments, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.card_payments, :precision => 2)) %> <br>
  </div> 
  <div class="col-md-2"> 
   <%= f.text_field :total_eft_taken, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.total_eft_taken, :precision => 2)) %><br>
   <font color=#D3D3D3>Till Report Cards</font> 
  </div>
  <div class="col-md-2" style="text-align:right"> 
   <font color=#ffffff><b><%= sprintf "%.2f", (@dailybank.card_payments- @dailybank.total_eft_taken) %></font></b><br>
   <font color=#D3D3D3>Card/Card Var</font> 
  </div>           
</div>  

<div class="row">
  <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :expenses, "No. of Expenses" %></font><br>
  </div>
  <div class="col-md-2">
 <% if @dailybank.expenses.any? %>
  <font color=#D3D3D3><%= @dailybank.expenses.count  %></font><%= link_to "See Expenses", show_many_expenses_path(:id => @dailybank.expenses.first.id), :class => "btn btn-xs btn-success", :style => "color:black" %> <br>
  <% end %>
  </div>
  <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :expenses, "Expenses Total" %></font><br>
  </div>       
  <div class="col-md-2">
  <%= f.text_field :expenses_total, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.expenses_total, :precision => 2))  %> <br>
  
  </div> 
  <div class="col-md-3"> 
   <%= f.text_field :actual_cash_total, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.actual_cash_total, :precision => 2))  %> <br>
   <b><font color=#FFDC00>Actual Takings</font></b>
  </div>       
</div>   

 <br>  <br>   

 <div class="row">
   <div class="col-md-2"> 
   <font color=#D3D3D3><%= f.label :wet_takings, "Wet Sales" %></font><br>
   <font color=#D3D3D3><%= f.label :dry_takings, "Dry Sales" %></font><br>
   <font color=#D3D3D3><%= f.label :merch_takings, "Misc Sales" %></font><br>
   </div>
   <div class="col-md-2">
   <%= f.text_field :wet_takings, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.wet_takings, :precision => 2))  %><br>
   <%= f.text_field :dry_takings, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.dry_takings, :precision => 2))  %><br>
   <%= f.text_field :merch_takings, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.merch_takings, :precision => 2))  %>
   </div>
   <div class="col-md-2"> 
   <font color=#D3D3D3><%= f.label :till_takings, "Total Sales" %></font><br>
   </div>       
   <div class="col-md-2">
   <%= f.text_field :till_takings, :disabled=>true, :style => "width:74px; text-align:right" %><br>
   </div>       
 </div> 

 <div class="row">
   <div class="col-md-2"> 
   <font color=#D3D3D3><%= f.label :vouchers_sold, "V's Sold" %></font><br>
   <font color=#D3D3D3><%= f.label :vouchers_used, "V's Used" %></font><br>
   <font color=#D3D3D3><%= f.label :deposit_sold, "D's Sold" %></font><br>
   </div>
   <div class="col-md-2">
   <%= f.text_field :vouchers_sold, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.vouchers_sold, :precision => 2))  %> <br>
   <%= f.text_field :vouchers_used, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.vouchers_used, :precision => 2))  %> <br>
   <%= f.text_field :deposit_sold, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.deposit_sold, :precision => 2))  %> <br>
   </div>
   <div class="col-md-2"> 
   <font color=#D3D3D3><%= f.label :v_d_adjustments, "D/V Adjustment" %></font><br>
   </div>       
   <div class="col-md-2">
   <%= f.text_field :v_d_adjustments, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.v_d_adjustments, :precision => 2))  %> <br>
   </div>       
 </div> 
 
 <div class="row">
   <div class="col-md-2"> 
   <font color=#D3D3D3><%= f.label :deposit_used, "D's Used"%></font>
   </div>
   <div class="col-md-2">
   <%= f.text_field :deposit_used, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.deposit_used, :precision => 2))  %> <br>
   </div>
   <div class="col-md-2"> 
    <font color=#FFDC00><%= f.label :calculated_variance, "Variance" %> </font>
    </div>       
    <div class="col-md-2">
    <%= f.text_field :calculated_variance, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.calculated_variance, :precision => 2)) %><br>
    </div>    
     
   <div class="col-md-3"> 
    <%= f.text_field :actual_till_takings, :disabled=>true, :style => "width:74px; text-align:right", :value => (number_with_precision(f.object.actual_till_takings, :precision => 2)) %><br>
    <b><font color=#FFDC00>Expected Takings</font></b>
   </div>           
 </div> 
 
<div class="row">
 <div class="col-md-2"> 
  <font color=#D3D3D3><%= f.label :variance_comment, "Variance Reason" %></font>
  </div>       
  <div class="col-md-6">
  <font color=#000000>
  <%= f.text_area :variance_comment, :cols => 48, :rows => 2 %></font>
  </div>       
</div> 

<br>
<div class="row">
 <div class="col-md-2 col-md-offset-2"> 
   <%= f.submit "Re-Calculate", class: "btn btn-sm btn-primary" %>
     <% end %>
  </div>

     <% end %>
   
   <div class="col-md-2 col-md-offset-2">
    <% if current_user.admin?  || current_user.super_user? %>
      <%= form_for @dailybank, :url => { :action => "mgmt_lock", params: {id: @dailybank.id} }, :html => { :method => "post" } do |f| %>
        <%= f.hidden_field :status, :value => "Locked" %>
        <%= f.submit "Mgmt Lock", class: "btn-sm btn-success" %>
        <% end %>
     <% end %>
  </div>
  <div class="col-md-4">
  <h6><%= link_to "Print End of Night report", download_end_of_night_pdf_path(:value => @dailybank.id, :format => 'pdf'), :style => "color:orange" %></h6>
  </div> 
   </div>
 </div>

 </div>

 